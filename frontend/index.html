<!DOCTYPE html>
<html>
<head>
    <title>Smart Archive Password Cracker</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        #result { margin-top: 20px; font-weight: bold; }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
        .warning { color: orange; }
        .status-box { margin: 10px 0; padding: 15px; background: #f5f5f5; border-radius: 5px; }
        .tool-status { margin: 5px 0; }
        .available { color: green; }
        .unavailable { color: red; }
        button { padding: 10px 20px; margin: 10px 0; cursor: pointer; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
    </style>
</head>
<body>
    <h1>Smart Archive Password Cracker</h1>
    <p>Upload a password-protected archive to brute-force its password.</p>
    
    <div class="status-box">
        <h3>System Status</h3>
        <div id="toolStatus">Checking available tools...</div>
    </div>
    
    <div class="status-box">
        <strong>Settings:</strong> 4-digit numbers (0-9)<br>
        <strong>Max attempts:</strong> 10,000 combinations<br>
        <strong>Formats:</strong> ZIP (always), RAR (if tools available)
    </div>
    
    <input type="file" id="archiveFile" accept=".zip,.rar">
    <button id="crackBtn" onclick="crackPassword()">Crack Password</button>
    <div id="result"></div>

    <script>
        let serverStatus = null;

        async function checkServerStatus() {
            try {
                const response = await fetch('http://127.0.0.1:5001/status');
                const data = await response.json();
                serverStatus = data;
                updateToolStatus(data);
                return true;
            } catch (error) {
                document.getElementById('toolStatus').innerHTML = 
                    '<span class="error">‚ùå Server not running. Please start the Flask application.</span>';
                return false;
            }
        }

        function updateToolStatus(data) {
            const statusDiv = document.getElementById('toolStatus');
            let html = '<div class="tool-status"><strong>Server:</strong> <span class="available">‚úì Running</span></div>';
            
            if (data.available_tools) {
                html += '<div class="tool-status"><strong>ZIP support:</strong> <span class="available">‚úì Always available</span></div>';
                
                const hasRarTools = Object.values(data.available_tools).some(available => available);
                if (hasRarTools) {
                    html += '<div class="tool-status"><strong>RAR support:</strong> <span class="available">‚úì Available</span></div>';
                    
                    // Show specific tools
                    for (const [tool, available] of Object.entries(data.available_tools)) {
                        if (available) {
                            html += `<div class="tool-status">  ‚Ä¢ ${tool}: <span class="available">‚úì</span></div>`;
                        }
                    }
                } else {
                    html += '<div class="tool-status"><strong>RAR support:</strong> <span class="unavailable">‚úó Not available</span></div>';
                    html += '<div class="tool-status"><small>Install 7z, unrar, or WinRAR for RAR support</small></div>';
                }
            }
            
            statusDiv.innerHTML = html;
        }

        async function crackPassword() {
            const fileInput = document.getElementById('archiveFile');
            const resultDiv = document.getElementById('result');
            const crackBtn = document.getElementById('crackBtn');
            
            if (!fileInput.files.length) {
                resultDiv.innerHTML = "<span class='error'>‚ùå Please select an archive file.</span>";
                return;
            }

            const file = fileInput.files[0];
            const fileName = file.name.toLowerCase();
            
            // Check file type and tool availability
            if (fileName.endsWith('.rar')) {
                if (!serverStatus || !Object.values(serverStatus.available_tools || {}).some(available => available)) {
                    resultDiv.innerHTML = "<span class='error'>‚ùå RAR files require external tools. Please install 7z, unrar, or WinRAR.</span>";
                    return;
                }
            } else if (!fileName.endsWith('.zip')) {
                resultDiv.innerHTML = "<span class='error'>‚ùå Please select a ZIP or RAR file.</span>";
                return;
            }

            crackBtn.disabled = true;
            resultDiv.innerHTML = "<span class='info'>üîç Cracking password... (this may take a while)</span>";
            
            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('http://127.0.0.1:5001/crack', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();

                if (data.password) {
                    resultDiv.innerHTML = `<span class='success'>‚úÖ Password found: <strong>${data.password}</strong></span>`;
                } else if (data.message) {
                    resultDiv.innerHTML = `<span class='info'>‚ÑπÔ∏è ${data.message}</span>`;
                } else if (data.error) {
                    resultDiv.innerHTML = `<span class='error'>‚ùå ${data.error}</span>`;
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<span class='error'>‚ùå Network error: ${error.message}</span>`;
            } finally {
                crackBtn.disabled = false;
            }
        }

        // Check server status on page load
        window.onload = async function() {
            await checkServerStatus();
        }
    </script>
</body>
</html>